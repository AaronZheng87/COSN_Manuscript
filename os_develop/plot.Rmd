---
title: "Untitled"
author: "郑元瑞"
date: "2022-09-28"
output: html_document
---
# 加载包
```{r}
library(tidyverse)
library(readxl)
library(treemapify)
library(ggthemes)
```

# 读取数据

## RN
```{r}
df.RN <- read_excel("/Users/zhengyuanrui/COSN_Manuscript/data/RN_Organization.xlsx")
```

```{r}
df.RN <- df.RN %>% 
  group_by(country, developed) %>% 
  summarise(n = n()) %>% 
  mutate(platform = "Reproducibility Network") %>% 
  rename("Region" = country)
df.RN 
```
## TEA
```{r}
df.TEA <- read_excel("/Users/zhengyuanrui/COSN_Manuscript/data/TEA_Organization.xlsx")
df.TEA <- df.TEA %>% 
  group_by(country, developed) %>% 
  summarise(n = n()) %>% 
  mutate(platform = "ReproducibiliTea") %>% 
  rename("Region" = country)
df.TEA
```
## SIPS
```{r}
df.SIPS <- read_excel("/Users/zhengyuanrui/COSN_Manuscript/data/SIPS_member.xlsx")
df.SIPS <- df.SIPS %>% 
  mutate(n = count) %>% 
  select(Region, developed, n) %>% 
  mutate(platform = "SIPS")
df.SIPS
```

```{r}
df.merge <- rbind(df.RN, df.TEA, df.SIPS)
```

```{r}
df.merge <- df.merge %>%
  mutate(
    developed = case_when(developed == 1 ~ "Developed",
                               developed == 0 ~"Developing",
                               developed == "NA"~ "Not Available"))
df.merge$developed <- factor(df.merge$developed, levels = c("Developed", "Developing", "Not Available"))
```


```{r}
df.RN_plot <- df.merge %>% 
  filter(platform == "Reproducibility Network") %>% 
  ggplot(aes(area = n, fill = developed, label=Region, 
             subgroup = developed, subgroup2 = Region)) +
  geom_treemap() +
  geom_treemap_subgroup_border(colour = "grey", size = 10) +
    geom_treemap_subgroup2_border(colour = "grey", size = 5) +
  geom_treemap_text(grow = T, reflow = T, colour = "white", place = "middle",
                     family = "Times New Roman") +
  scale_fill_manual(
     values = c("#3288bd", "#e6610", "#f7f7f7")
  ) +
   theme(
      legend.title=element_text(size =55), #图例标题字体
      legend.text = element_text(size=55, family="Times New Roman", face = "bold"),#图例字体
      legend.key.size = unit(80, "pt"),
       legend.position = "bottom") + #水平放
  guides(fill = "none") + ggtitle("Reproducibility Network") +
  theme(plot.title = element_text(hjust = 0.5, 
                                  family="Times New Roman", 
                                  size = 40,face = "bold")) 
df.RN_plot
#ggsave(filename = "RN_Org.png", plot = df.RN_plot, width = 48, height = 20, dpi = 300)
```


```{r}
df.TEA_plot <- df.merge %>% 
  filter(platform == "ReproducibiliTea") %>% 
  ggplot(aes(area = n, fill = developed, label=Region, 
             subgroup = developed, subgroup2 = Region)) +
  geom_treemap() +
  geom_treemap_subgroup_border(colour = "grey", size = 10) +
    geom_treemap_subgroup2_border(colour = "grey", size = 5) +
  geom_treemap_text(grow = T, reflow = T, colour = "white", place = "middle",
                     family = "Times New Roman")+ 
  scale_fill_manual(
     values = c("#3288bd", "#e66102", "#f7f7f7")
  ) +
   theme(
      legend.title=element_text(size =55), #图例标题字体
      legend.text = element_text(size=55, family="Times New Roman", face = "bold"),#图例字体
      legend.key.size = unit(80, "pt"),
       legend.position = "bottom") + #水平放
  guides(fill = "none") + ggtitle("ReproducibiliTea") +
  theme(plot.title = element_text(hjust = 0.5,
                                  family="Times New Roman", 
                                  size = 40, face = "bold")) 
df.TEA_plot
#ggsave(filename = "TEA_Org.png", plot = df.TEA_plot, width = 48, height = 20, dpi = 300)
```


```{r}
df.SIPS_plot <- df.merge %>% 
  filter(platform == "SIPS") %>% 
  ggplot(aes(area = n, fill = developed, label=Region, 
             subgroup = developed, subgroup2 = Region)) +
  geom_treemap() +
  geom_treemap_subgroup_border(colour = "grey", size = 10) +
    geom_treemap_subgroup2_border(colour = "grey", size = 5) +
  geom_treemap_text(grow = T, reflow = T, colour = "white", place = "middle",
                     family = "Times New Roman") +
  scale_fill_manual(
     values = c("#99d594", "#fc9272", "#f7f7f7")
  ) +#fc9272
   theme(
      legend.title=element_text(size =55), #图例标题字体
      legend.text = element_text(size=55, family="Times New Roman", face = "bold"),#图例字体
      legend.key.size = unit(80, "pt"),
       legend.position = "bottom") + #水平放
  guides(fill = "none") + ggtitle("SIPS") +
  theme(plot.title = element_text(hjust = 0.5, family="Times New Roman", 
                                  size = 40, face = "bold")) 
df.SIPS_plot
#ggsave(filename = "SIPS_Mem.png", plot = df.SIPS_plot, width = 48, height = 20, dpi = 300)
```


```{r}
library(patchwork)
```


```{r}
RN_p <- df.RN_plot + theme(plot.margin = unit(c(0,100,50,0), "pt"))

sips_p <- df.SIPS_plot + theme(plot.margin = unit(c(0,100,50,0), "pt"))
tea_p <- df.TEA_plot + theme(plot.margin = unit(c(0,100,50,0), "pt"))
```

## Organization
```{r}
combine_o <- (RN_p|tea_p|osgcn)
```


```{r}
a_plot <- (cos|sips_p)/(RN_p|tea_p|osgcn)
ggsave(filename = "all2.png", plot = a_plot, width = 40, height = 30, dpi = 300)
```

